import React, { useState, useEffect, useRef } from 'react';
import { ChefHat, Utensils, Trophy, Search, CheckCircle2, Heart, Zap, Bone, Sparkles, ArrowRight, BookOpen } from 'lucide-react';

// --- éŠæˆ²è³‡æ–™è¨­å®š (Game Data) ---

// é£Ÿææ¸…å–® (Ingredients)
const INGREDIENTS_DATA = [
  { id: 'black_sesame', name_en: 'Black Sesame', name_zh: 'é»‘èŠéº»', icon: 'âš«' },
  { id: 'white_sesame', name_en: 'White Sesame', name_zh: 'ç™½èŠéº»/æ²¹', icon: 'âšª' },
  { id: 'sugar', name_en: 'Sugar', name_zh: 'ç³–', icon: 'ğŸ¬' },
  { id: 'flour', name_en: 'Flour', name_zh: 'éºµç²‰', icon: 'ğŸŒ¾' },
  { id: 'chicken', name_en: 'Chicken', name_zh: 'é›è‚‰', icon: 'ğŸ—' },
  // FIX: ğŸ«š ç‚ºæ–°ç‰ˆ Emojiï¼ŒèˆŠè£ç½®ç„¡æ³•é¡¯ç¤ºï¼Œæ”¹ç”¨å½¢ç‹€ç›¸ä¼¼çš„ ğŸ¥” ä»£æ›¿å¡Šæ ¹é¡ï¼Œæˆ–ä½¿ç”¨åœ–ç‰‡
  { id: 'ginger', name_en: 'Ginger', name_zh: 'è€è–‘', icon: 'ğŸ¥”' }, 
  { id: 'noodles', name_en: 'Noodles', name_zh: 'éºµæ¢', icon: 'ğŸœ' },
  { id: 'rice_wine', name_en: 'Rice Wine', name_zh: 'ç±³é…’', icon: 'ğŸ¶' },
  { id: 'cheese', name_en: 'Cheese', name_zh: 'èµ·å¸', icon: 'ğŸ§€' },
];

// é£Ÿè­œæ¸…å–® (Recipes) - åŠ å…¥ç™‚æ•ˆ (benefit)
const RECIPES_DATA = [
  { 
    id: 'r1', 
    name_en: 'Sesame Candy', 
    name_zh: 'èŠéº»ç³–', 
    req: ['white_sesame', 'sugar'], 
    score: 100,
    desc: 'é¦™ç”œé…¥è„†ï¼',
    benefit_en: 'High Calcium!',
    benefit_zh: 'ç™½èŠéº»éˆ£è³ªè±å¯Œï¼Œå¼·å¥éª¨éª¼ï¼',
    icon: <Bone className="w-5 h-5 text-gray-500" />
  },
  { 
    id: 'r2', 
    name_en: 'Sesame Bun', 
    name_zh: 'èŠéº»åŒ…', 
    req: ['flour', 'black_sesame', 'sugar'], 
    score: 150,
    desc: 'ç†±æ°£é¨°é¨°ï¼',
    benefit_en: 'Vitamin E & Hair Care',
    benefit_zh: 'é»‘èŠéº»å¯Œå«ç¶­ç”Ÿç´ Eï¼Œçƒé»‘ç§€é«®ï¼',
    icon: <Sparkles className="w-5 h-5 text-purple-500" />
  },
  { 
    id: 'r3', 
    name_en: 'Sesame Noodles', 
    name_zh: 'éº»é†¬éºµ', 
    req: ['noodles', 'white_sesame'], 
    score: 120,
    desc: 'å°‡é†¬æ±æ‹Œå‹»ã€‚',
    benefit_en: 'Good Fats',
    benefit_zh: 'èŠéº»æ²¹è„‚æ˜¯å¥½æ²¹ï¼Œå¹«åŠ©æ¶ˆåŒ–ï¼',
    icon: <Heart className="w-5 h-5 text-red-500" />
  },
  { 
    id: 'r4', 
    name_en: 'Sesame Oil Chicken', 
    name_zh: 'éº»æ²¹é›', 
    req: ['chicken', 'white_sesame', 'ginger', 'rice_wine'], 
    score: 300,
    desc: 'é¦™æ°£å››æº¢ï¼',
    benefit_en: 'Warm Body & Circulation',
    benefit_zh: 'æº«è£œèº«é«”ï¼Œä¿ƒé€²è¡€æ¶²å¾ªç’°ï¼',
    icon: <Zap className="w-5 h-5 text-yellow-500" />
  },
  { 
    id: 'r5', 
    name_en: 'Sesame Pizza', 
    name_zh: 'èŠéº»é¤…çš®æŠ«è–©', 
    req: ['flour', 'white_sesame', 'cheese'], 
    score: 200,
    desc: 'æ¿ƒéƒèµ·å¸èˆ‡å …æœé¦™ï¼',
    benefit_en: 'Double Calcium Power',
    benefit_zh: 'èŠéº»åŠ èµ·å¸ï¼Œé›™é‡è£œéˆ£ï¼',
    icon: <Bone className="w-5 h-5 text-blue-500" />
  },
];

// --- è¼”åŠ©å‡½å¼ ---
const getRandomIngredient = () => {
  const randomIndex = Math.floor(Math.random() * INGREDIENTS_DATA.length);
  // åŠ å…¥ uniqueId é˜²æ­¢ React key é‡è¤‡å•é¡Œ
  return { ...INGREDIENTS_DATA[randomIndex], uniqueId: Math.random().toString(36).substr(2, 9) };
};

const getRandomRecipe = () => {
  const randomIndex = Math.floor(Math.random() * RECIPES_DATA.length);
  return RECIPES_DATA[randomIndex];
};

// --- å…ƒä»¶ ---

const Card = ({ item, isNew }) => (
  <div className={`
    relative flex flex-col items-center justify-center 
    w-20 h-24 bg-white border-2 border-amber-200 rounded-lg shadow-sm shrink-0
    transform transition-all duration-300 select-none
    ${isNew ? 'scale-110 ring-2 ring-yellow-400' : 'hover:-translate-y-1'}
  `}>
    <div className="text-2xl mb-1">{item.icon}</div>
    <div className="text-[10px] font-bold text-gray-800 text-center leading-tight px-1 break-words w-full">{item.name_en}</div>
    <div className="text-[10px] text-gray-500 text-center">{item.name_zh}</div>
  </div>
);

const Opponent = ({ name, handCount, score, status, avatarColor }) => (
  <div className="flex flex-col items-center p-2 bg-amber-50 rounded-xl border border-amber-100 shadow-sm w-1/3 mx-1 transition-all">
    <div className={`w-10 h-10 md:w-12 md:h-12 rounded-full flex items-center justify-center text-white font-bold mb-1 shadow-inner ${avatarColor}`}>
      {name[0]}
    </div>
    <h3 className="font-bold text-gray-700 text-xs md:text-sm">{name}</h3>
    <div className="text-[10px] md:text-xs text-gray-500 mb-1">å¾—åˆ†: {score}</div>
    <div className="flex items-center gap-1 bg-white px-2 py-1 rounded-full border border-gray-200">
      <div className="w-2 h-3 md:w-3 md:h-4 bg-blue-400 rounded-sm"></div>
      <span className="text-[10px] md:text-xs font-bold">x {handCount}</span>
    </div>
    <div className="h-4 w-full flex items-center justify-center mt-1">
      {status && (
        <div className="text-[10px] font-bold text-amber-600 animate-bounce leading-tight truncate">
          {status}
        </div>
      )}
    </div>
  </div>
);

export default function SesameChefGame() {
  // éŠæˆ²ç‹€æ…‹
  const [gameStatus, setGameStatus] = useState('menu'); // menu, playing, end
  const [currentOrder, setCurrentOrder] = useState(null); // æ”¹å›å–®ä¸€ç‰©ä»¶ï¼Œéé™£åˆ—
  const [turn, setTurn] = useState(0); // 0 = Player, 1-3 = CPU
  const [logs, setLogs] = useState([]);
  
  // ç©å®¶èˆ‡é›»è…¦è³‡æ–™
  const [playerHand, setPlayerHand] = useState([]);
  const [playerScore, setPlayerScore] = useState(0);
  
  // åˆå§‹å°æ‰‹è³‡æ–™
  const [opponents, setOpponents] = useState([
    { id: 1, name: 'å°è¯ (Alex)', hand: [], score: 0, status: '', color: 'bg-red-400' },
    { id: 2, name: 'é˜¿æ˜ (Ben)', hand: [], score: 0, status: '', color: 'bg-green-400' },
    { id: 3, name: 'å°ç¾ (Cathy)', hand: [], score: 0, status: '', color: 'bg-purple-400' },
  ]);

  const logsEndRef = useRef(null);

  // è‡ªå‹•æ²å‹•æ—¥èªŒ
  useEffect(() => {
    logsEndRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [logs]);

  // åˆå§‹åŒ–éŠæˆ²
  const startGame = () => {
    setPlayerHand([]);
    setPlayerScore(0);
    setOpponents(prev => prev.map(opp => ({ ...opp, hand: [], score: 0, status: '' })));
    setLogs(['éŠæˆ²é–‹å§‹ï¼æ­¡è¿ä¾†åˆ°èƒ¡éº»å°å»šç¥ï¼']);
    setCurrentOrder(getRandomRecipe()); // åˆå§‹åŒ–å–®ä¸€è¨‚å–®
    setTurn(0);
    setGameStatus('playing');
  };

  const addLog = (msg) => {
    setLogs(prev => [...prev.slice(-5), msg]);
  };

  // æª¢æŸ¥æ˜¯å¦å¯ä»¥çƒ¹é£ª
  const canCook = (hand, recipe) => {
    if (!recipe) return false;
    const handIds = hand.map(h => h.id);
    return recipe.req.every(reqId => handIds.includes(reqId));
  };

  // åŸ·è¡Œçƒ¹é£ªé‚è¼¯
  const performCook = (who, hand, setHandFn, currentScore, setScoreFn, name) => {
    // æ‰£é™¤é£Ÿæ (æ¯å€‹éœ€è¦çš„é£Ÿæåªæ‰£é™¤ä¸€å€‹)
    let newHand = [...hand];
    currentOrder.req.forEach(reqId => {
      const index = newHand.findIndex(h => h.id === reqId);
      if (index !== -1) newHand.splice(index, 1);
    });
    
    setHandFn(newHand);
    const newScore = currentScore + currentOrder.score;
    setScoreFn(newScore);
    
    // é¡¯ç¤ºæˆåŠŸèˆ‡ç™‚æ•ˆè¨Šæ¯
    addLog(`ğŸ‰ ${name} å®Œæˆäº† ${currentOrder.name_zh}! (+${currentOrder.score})`);
    
    // æª¢æŸ¥å‹åˆ©
    if (newScore >= 600) {
      setGameStatus('end');
      addLog(`ğŸ† ${name} è´å¾—äº†æ¯”è³½ï¼`);
      return true; // Game Over
    }

    // æ›¿æ›æ–°è¨‚å–®
    const nextOrder = getRandomRecipe();
    setCurrentOrder(nextOrder);

    addLog(`ğŸ”” æ–°è¨‚å–®: ${nextOrder.name_en} (${nextOrder.name_zh})`);
    return false; // Game Continues
  };

  // é›»è…¦ AI é‚è¼¯
  useEffect(() => {
    if (gameStatus !== 'playing' || turn === 0) return;

    const currentCpuIndex = turn - 1;
    const cpu = opponents[currentCpuIndex];
    
    // æ¨¡æ“¬æ€è€ƒæ™‚é–“
    const timer = setTimeout(() => {
      // ç­–ç•¥ï¼šç›´æ¥æª¢æŸ¥ç›®å‰çš„è¨‚å–®
      if (canCook(cpu.hand, currentOrder)) {
        // åŸ·è¡Œçƒ¹é£ª
        setOpponents(prev => {
          const newOpps = [...prev];
          const isGameOver = performCook(
            cpu.name, 
            cpu.hand, 
            (h) => { newOpps[currentCpuIndex].hand = h; }, 
            cpu.score, 
            (s) => { newOpps[currentCpuIndex].score = s; }, 
            cpu.name
          );
          
          if (!isGameOver) {
             newOpps[currentCpuIndex].status = 'Cooking!';
             setTimeout(() => {
                setOpponents(curr => {
                    const clean = [...curr];
                    if(clean[currentCpuIndex]) clean[currentCpuIndex].status = '';
                    return clean;
                });
             }, 1500);
          }
          return newOpps;
        });
      } else {
        // ä¸èƒ½ç…®ï¼ŒæŠ½ç‰Œ
        const newItem = getRandomIngredient();
        setOpponents(prev => {
          const newOpps = [...prev];
          newOpps[currentCpuIndex].hand.push(newItem);
          newOpps[currentCpuIndex].status = `+ ${newItem.name_zh}`;
          return newOpps;
        });
        
        setTimeout(() => {
           setOpponents(curr => {
             const clean = [...curr];
             if(clean[currentCpuIndex]) clean[currentCpuIndex].status = '';
             return clean;
           });
        }, 1000);
      }

      // å¦‚æœéŠæˆ²æ²’çµæŸï¼Œæ›ä¸‹ä¸€ä½
      setOpponents(currentOpps => {
         const isAnyoneWin = currentOpps.some(o => o.score >= 600);
         // æ³¨æ„ï¼šé€™è£¡å› ç‚º state æ›´æ–°éåŒæ­¥ï¼Œæˆ‘å€‘å‡è¨­å¦‚æœå‰›æ‰ performCook å›å‚³ true å‰‡ä¸ç¹¼çºŒ
         // ç°¡å–®åšæ³•ï¼šæª¢æŸ¥ç¾åœ¨çš„åˆ†æ•¸ç‹€æ…‹
         if (!isAnyoneWin && playerScore < 600) {
            setTurn(prev => (prev + 1) % 4);
         }
         return currentOpps;
      });

    }, 1500); 

    return () => clearTimeout(timer);
  }, [turn, gameStatus, currentOrder, playerScore]); 

  // ç©å®¶å‹•ä½œï¼šæŠ½ç‰Œ
  const playerDraw = () => {
    if (turn !== 0) return;
    
    const newItem = getRandomIngredient();
    setPlayerHand(prev => [...prev, newItem]);
    addLog(`ä½ æ‰¾åˆ°äº†: ${newItem.name_en} (${newItem.name_zh})`);
    setTurn(1); // æ›é›»è…¦
  };

  // ç©å®¶å‹•ä½œï¼šçƒ¹é£ª
  const playerCook = () => {
    if (turn !== 0) return;
    
    if (!canCook(playerHand, currentOrder)) {
      addLog("âŒ é£Ÿæä¸å¤ ï¼é‚„ç¼ºä¸€é»æ±è¥¿...");
      return;
    }

    performCook('ä½ ', playerHand, setPlayerHand, playerScore, setPlayerScore, 'ç©å®¶');

    // å¦‚æœæ²’æœ‰è´ï¼Œæ‰æ›ä¸‹ä¸€ä½
    if (playerScore + currentOrder.score < 600) {
        setTurn(1);
    }
  };

  const hasIngredient = (reqId) => playerHand.some(i => i.id === reqId);
  const isPlayerTurn = turn === 0;
  const readyToCook = currentOrder && canCook(playerHand, currentOrder);

  // --- ç•«é¢æ¸²æŸ“ ---

  if (gameStatus === 'menu') {
    return (
      <div className="flex flex-col items-center justify-center min-h-screen bg-amber-50 font-sans p-4 select-none">
        <div className="bg-white p-8 rounded-3xl shadow-xl text-center max-w-md w-full border-4 border-amber-400">
          <ChefHat className="w-20 h-20 mx-auto text-amber-500 mb-4" />
          <h1 className="text-4xl font-black text-gray-800 mb-2">èƒ¡éº»å°å»šç¥</h1>
          <h2 className="text-xl text-amber-600 font-bold mb-6">The Sesame Chef</h2>
          
          <div className="space-y-4 text-left bg-amber-50 p-5 rounded-xl mb-6 text-sm text-gray-600">
            <p className="flex gap-2">ğŸ‘¨â€ğŸ³ <b>ç›®æ¨™ï¼š</b> <span>æ”¶é›†é£Ÿæï¼Œå®Œæˆèƒ¡éº»æ–™ç†è¨‚å–®ã€‚</span></p>
            <p className="flex gap-2">ğŸ’Š <b>å­¸ç¿’ï¼š</b> <span>èªè­˜èƒ¡éº»(Sesame)çš„å¥åº·åŠŸæ•ˆã€‚</span></p>
            <p className="flex gap-2">ğŸ† <b>å‹åˆ©ï¼š</b> <span>æœ€å…ˆç²å¾— <span className="text-amber-600 font-bold">600åˆ†</span> çš„äººç²å‹ï¼</span></p>
          </div>

          <button 
            onClick={startGame}
            className="w-full py-4 bg-amber-500 hover:bg-amber-600 text-white text-xl font-bold rounded-xl transition-transform active:scale-95 shadow-lg flex items-center justify-center gap-2"
          >
            <Utensils className="w-6 h-6" /> é–‹å§‹æ–™ç†ï¼
          </button>
        </div>
      </div>
    );
  }

  if (gameStatus === 'end') {
    const winner = playerScore >= 600 ? 'ä½  (You)' : opponents.find(o => o.score >= 600)?.name || 'Someone';
    const isPlayerWin = playerScore >= 600;

    return (
      <div className="flex flex-col items-center justify-center min-h-screen bg-amber-50 font-sans p-4">
        <div className="bg-white p-8 rounded-3xl shadow-xl text-center max-w-md w-full border-4 border-amber-400">
          <Trophy className={`w-24 h-24 mx-auto mb-4 animate-bounce ${isPlayerWin ? 'text-yellow-500' : 'text-gray-400'}`} />
          <h1 className="text-3xl font-black text-gray-800 mb-2">éŠæˆ²çµæŸï¼</h1>
          <p className="text-xl text-gray-600 mb-6">
            ç²å‹è€…æ˜¯ï¼š <span className="font-bold text-amber-600 text-2xl">{winner}</span>
          </p>
          <div className="flex justify-between px-8 py-4 bg-gray-50 rounded-xl mb-6">
            <div className="text-center">
              <div className="text-xs text-gray-400">ä½ çš„åˆ†æ•¸</div>
              <div className="font-bold text-xl">{playerScore}</div>
            </div>
            <div className="text-center">
               <div className="text-xs text-gray-400">æœ€é«˜åˆ†æ•¸</div>
               <div className="font-bold text-xl">{Math.max(playerScore, ...opponents.map(o => o.score))}</div>
            </div>
          </div>
          <button 
            onClick={() => setGameStatus('menu')}
            className="w-full py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-xl font-bold transition-colors"
          >
            å†ç©ä¸€æ¬¡ (Play Again)
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="flex flex-col min-h-screen bg-slate-100 font-sans max-w-lg mx-auto shadow-2xl overflow-hidden relative">
      
      {/* é ‚éƒ¨ï¼šå°æ‰‹å€ */}
      <div className="bg-white p-2 md:p-3 flex justify-between items-start shadow-sm z-10 shrink-0">
        {opponents.map((opp) => (
          <Opponent key={opp.id} {...opp} avatarColor={opp.color} />
        ))}
      </div>

      {/* ä¸­å¤®ï¼šéŠæˆ²æ¡Œèˆ‡è¨‚å–® */}
      <div className="flex-1 bg-amber-100 relative p-4 flex flex-col items-center overflow-hidden">
        
        {/* å–®ä¸€è¨‚å–®å¡ (ç½®ä¸­ã€æ”¾å¤§) */}
        {currentOrder && (
          <div className={`
            w-full max-w-xs bg-white rounded-2xl p-4 shadow-xl border-4 transition-all duration-500 relative flex flex-col
            ${readyToCook && isPlayerTurn ? 'border-green-400 ring-4 ring-green-200 scale-105 z-20' : 'border-amber-300'}
          `}>
             {/* Ready Label */}
             {readyToCook && isPlayerTurn && (
               <div className="absolute -top-3 -right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full animate-bounce shadow-md z-30 flex items-center gap-1">
                 <CheckCircle2 className="w-3 h-3"/> å¯çƒ¹é£ª!
               </div>
             )}

            {/* Header */}
            <div className="flex justify-between items-center mb-2 border-b-2 border-dashed border-gray-100 pb-2">
              <span className="text-amber-600 font-black text-xl">+{currentOrder.score} åˆ†</span>
              <div className="text-gray-400 text-xs italic">Current Order</div>
            </div>

            {/* Main Content */}
            <div className="text-center mb-3">
              <h2 className="text-2xl font-black text-gray-800 leading-tight mb-1">{currentOrder.name_en}</h2>
              <h3 className="text-lg text-gray-500 font-bold">{currentOrder.name_zh}</h3>
            </div>

            {/* Ingredients Needed */}
            <div className="flex justify-center gap-2 mb-4">
               {currentOrder.req.map((reqId, i) => {
                 const ing = INGREDIENTS_DATA.find(x => x.id === reqId);
                 const have = hasIngredient(reqId);
                 return (
                   <div key={i} className={`flex flex-col items-center transition-all ${have ? 'opacity-100 scale-110' : 'opacity-40 grayscale'}`}>
                     <div className={`w-10 h-10 flex items-center justify-center rounded-full text-xl border-2 mb-1 ${have ? 'bg-green-100 border-green-400' : 'bg-gray-100 border-gray-300'}`}>
                       {ing.icon}
                     </div>
                     <span className="text-[10px] font-bold text-gray-500">{ing.name_zh}</span>
                   </div>
                 )
               })}
            </div>

            {/* Health Benefit Section - Prominent Display */}
            <div className="mt-auto bg-green-50 border-2 border-green-100 rounded-xl p-3 flex items-start gap-3 relative overflow-hidden">
               <div className="absolute -right-2 -bottom-2 text-green-100/50">
                 <BookOpen size={64} />
               </div>
               <div className="p-2 bg-green-200/50 rounded-full text-green-700 shrink-0 z-10">
                 {currentOrder.icon}
               </div>
               <div className="z-10">
                 <h4 className="font-bold text-green-800 text-xs uppercase tracking-wider mb-0.5 flex items-center gap-1">
                   èƒ¡éº»å°çŸ¥è­˜
                 </h4>
                 <p className="text-sm text-green-900 font-medium leading-tight">
                   {currentOrder.benefit_zh}
                 </p>
               </div>
            </div>
          </div>
        )}

        {/* Log å€ (ç¸®å°æ”¾åˆ°æœ€ä¸‹é¢ï¼Œé¿å…å¹²æ“¾) */}
        <div className="w-full mt-auto h-20 overflow-y-auto bg-black/5 rounded-xl p-2 text-sm backdrop-blur-sm border border-white/50 shadow-inner">
           {logs.map((log, i) => {
             const isBenefit = log.includes('åŠŸæ•ˆ') || log.includes('Benefit');
             return (
                <div key={i} className={`mb-1 border-l-2 pl-2 rounded-r-md text-xs py-1 ${isBenefit ? 'bg-green-100 border-green-500 text-green-800 font-bold' : 'bg-white/60 border-amber-500 text-gray-700'}`}>
                  {log}
                </div>
             );
           })}
           <div ref={logsEndRef} />
        </div>

      </div>

      {/* åº•éƒ¨ï¼šç©å®¶å€ */}
      <div className={`bg-white p-3 md:p-4 rounded-t-3xl shadow-[0_-5px_20px_rgba(0,0,0,0.1)] transition-colors duration-500 shrink-0 z-20 ${isPlayerTurn ? 'border-t-4 border-green-400' : 'border-t-4 border-gray-200'}`}>
        
        {/* ç©å®¶è³‡è¨Š */}
        <div className="flex justify-between items-end mb-2 px-1">
          <div>
            <span className="text-[10px] font-bold text-gray-400 uppercase tracking-wider">ç©å®¶ (You)</span>
            <div className="text-2xl font-black text-gray-800 leading-none">{playerScore} <span className="text-xs font-normal text-gray-400">åˆ†</span></div>
          </div>
          <div className={`text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1 ${isPlayerTurn ? 'bg-green-100 text-green-600 animate-pulse' : 'bg-gray-100 text-gray-400'}`}>
            {isPlayerTurn ? <ArrowRight className="w-3 h-3"/> : null}
            {isPlayerTurn ? "æ›ä½ è¡Œå‹•ï¼" : "å°æ‰‹æ€è€ƒä¸­..."}
          </div>
        </div>

        {/* æ‰‹ç‰Œå€ */}
        <div className="flex gap-2 overflow-x-auto pb-2 px-1 min-h-[100px] items-center">
          {playerHand.length === 0 && (
            <div className="text-gray-400 text-xs flex items-center w-full justify-center border-2 border-dashed border-gray-200 rounded-lg h-20 bg-gray-50 w-full">
              ç›®å‰æ²’æœ‰æ‰‹ç‰Œï¼Œè«‹æŒ‰ä¸‹ã€Œæœå°‹é£Ÿæã€
            </div>
          )}
          {playerHand.map((item, idx) => (
            // ä½¿ç”¨ uniqueId ç¢ºä¿ key å”¯ä¸€
            <Card key={item.uniqueId || `${item.id}-${idx}`} item={item} isNew={idx === playerHand.length - 1} />
          ))}
        </div>

        {/* æ§åˆ¶æŒ‰éˆ• */}
        <div className="grid grid-cols-2 gap-3 mt-1">
          <button 
            onClick={playerDraw}
            disabled={!isPlayerTurn}
            className={`
              flex items-center justify-center gap-2 py-3 rounded-xl font-bold text-lg shadow-md transition-all
              ${isPlayerTurn 
                ? 'bg-blue-500 hover:bg-blue-600 text-white active:scale-95' 
                : 'bg-gray-200 text-gray-400 cursor-not-allowed'}
            `}
          >
            <Search className="w-5 h-5" />
            <div className="flex flex-col items-start leading-none">
              <span>æœå°‹é£Ÿæ</span>
              <span className="text-[10px] font-normal opacity-80">(æŠ½ç‰Œ)</span>
            </div>
          </button>

          <button 
            onClick={playerCook}
            disabled={!isPlayerTurn || !readyToCook}
            className={`
              flex items-center justify-center gap-2 py-3 rounded-xl font-bold text-lg shadow-md transition-all
              ${isPlayerTurn && readyToCook
                ? 'bg-amber-500 hover:bg-amber-600 text-white animate-pulse active:scale-95 ring-2 ring-amber-300' 
                : 'bg-gray-200 text-gray-400 cursor-not-allowed'}
            `}
          >
            <Utensils className="w-5 h-5" />
            <div className="flex flex-col items-start leading-none">
              <span>Cook!</span>
              <span className="text-[10px] font-normal opacity-80">(å¾—åˆ†)</span>
            </div>
          </button>
        </div>

      </div>
    </div>
  );
}
